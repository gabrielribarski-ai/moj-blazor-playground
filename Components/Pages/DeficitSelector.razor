@using IzracunInvalidnostiBlazor.Models
@using System.Globalization

<label class="form-label">@Stran</label>
<select class="form-select form-select-sm deficit-selector"
        @onchange="OnChanged">
    <option value="">— izberi —</option>
    @foreach (var def in MozniZaStran)
    {
        <option value="@def.IzracunaniOdstotek?.ToString(CultureInfo.InvariantCulture)">
            @def.IzbiraOpis %
        </option>
    }
</select>

@code {
    [Parameter] public StranLDE Stran { get; set; }
    [Parameter] public IEnumerable<MozniDeficit> MozniZaStran { get; set; } = Enumerable.Empty<MozniDeficit>();
    [Parameter] public EventCallback<(StranLDE stran, decimal? val)> OnSelectionChanged { get; set; }

    private async Task OnChanged(ChangeEventArgs e)
    {
        var raw = e.Value?.ToString();
        decimal? parsed = string.IsNullOrWhiteSpace(raw)
            ? null
            : decimal.TryParse(raw, NumberStyles.Number, CultureInfo.InvariantCulture, out var v) ? v : null;

        await OnSelectionChanged.InvokeAsync((Stran, parsed));
    }
}
